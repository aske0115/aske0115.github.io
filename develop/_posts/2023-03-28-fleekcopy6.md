# SwiftUI + Combineì„ ì´ìš©í•˜ì—¬ Fleek Copy app ë§Œë“¤ê¸°(3-4)

ì•ˆë…•í•˜ì„¸ìš”. 

ì˜¤ëŠ˜ì€ [**ì´ì „ í¬ìŠ¤íŠ¸**](https://aske0115.github.io/develop/2023-03-24-fleekcopy5/)ì— ì´ì–´, timerê´€ë ¨ëœ ë‚´ìš©ì„ ì´ì•¼ê¸° í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

---

ì €ë²ˆì‹œê°„ê¹Œì§€ ì‘ì„±ëœ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```swift
import SwiftUI
import Combine

struct SplashView: View  {
    @State private var progress: Float = 0.0
    @State private var isComplete: Bool = false
    
    let duration: Double = 3.0
    
    var timer: Publishers.Autoconnect<Timer.TimerPublisher> {
           Timer.publish(every: 0.01, on: .main, in: .common).autoconnect()
    }
    
    var body: some View {
        Group {
            if !isComplete {
                VStack {
                    Text("FLEEK")
                        .foregroundColor(.red)
                        .fontWeight(.heavy)
                        .font(.largeTitle)
                    Text("ë‹¹ì‹ ì˜ ìš´ë™ì„ ì˜ë¯¸ìˆê²Œ!")
                        .foregroundColor(.white)
                    
                    ProgressView(value: progress)
                        .animation(.linear(duration: duration), value: progress)
                        .tint(.red)
                        .frame(width: 160)
                }
                
                .opacity(isComplete ? 0 : 1)
                .frame(maxWidth: .infinity, maxHeight: .infinity)
                .background(.black)
            } else {
                MainTabView()
                    .opacity(isComplete ? 1 : 0)
            }
        }
        .onReceive(timer) { _ in
            if progress < 1.0 {
                progress = min(1.0, progress + 0.004)
            } else {
                withAnimation(.easeOut(duration: 1.0)) {
                    isComplete = true
                }
            }
        }
    }
}
```

---

ìœ„ ì½”ë“œì—ì„œ ì‚¬ìš©í•œ Timerë¥¼ ì‚´í‘œë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

## TimerPublisher

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-27 á„‹á…©á„’á…® 10.34.37.png](/assets/img/blog/fleekCopy/timerpublisher.png)

> ì£¼ì–´ì§„ intervalë§ˆë‹¤ í˜„ì¬ì˜ ì‹œê°„ì„ emití•˜ëŠ” publisher ë¼ê³  ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤.
> 

```swift
  Timer.publish(every: 0.01, on: .main, in: .common).autoconnect()
```

---

0.01ì´ˆë§ˆë‹¤ main Runloopì— common ëª¨ë“œë¡œ ë™ì‘í•˜ëŠ” TImer.TimerPublisherë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ë´ì•¼í•  ë¶€ë¶„ì€ autoconnect()ë¼ëŠ” ë©”ì†Œë“œ ì¸ë°ìš”.

## autoconnect()

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-27 á„‹á…©á„’á…® 10.37.59.png](/assets/img/blog/fleekCopy/autoconnect.png)

<aside>
ğŸ˜µâ€ğŸ’« ì•„ë¬´ëŸ° ì„¤ëª…ì´ ì—†ë„¤ìš”.. Publishers.Autoconnect<Timer.TimerPublisher>ë¥¼ ë¦¬í„´í•´ì£¼ë„¤ìš”. Publishers.AutoconnectëŠ” ë¬´ì—ˆì¸ì§€ ë”°ë¼ê°€ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.   
</aside>

---

## Publishers.Autoconnect
    
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-27 á„‹á…©á„’á…® 10.40.21.png](/assets/img/blog/fleekCopy/publisherautoconnect.png)

- upstreamì—°ê²°ì´ ê°€ëŠ¥í•œ Publisherì— ìë™ìœ¼ë¡œ connectë˜ëŠ” publisherë¼ê³  ë˜ì–´ìˆìŠµë‹ˆë‹¤.
- ê°ì´ ì˜ ì˜¤ì§€ ì•Šë„¤ìš”. Overviewë¥¼ ì½ì–´ë³´ê² ìŠµë‹ˆë‹¤.
    - í•´ë‹¹ Publisherì— subscriberê°€ êµ¬ë…ì„ ì‹œì‘í•˜ë©´ ìë™ìœ¼ë¡œ connect()ë¥¼ í˜¸ì¶œí•´ ì¤€ë‹¤ê³  ë˜ì–´ìˆë„¤ìš”.
- connect()ëŠ” ë­í•˜ëŠ” ë…€ì„ì¼ê¹Œìš”??

## Connect()

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-27 á„‹á…©á„’á…® 10.42.29.png](/assets/img/blog/fleekCopy/connect.png)

- publisherì— ì—°ê²°í•˜ì—¬ ìš”ì†Œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì·¨ì†Œí•  ì¸ìŠ¤í„´ìŠ¤(cancellable)ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
- ì—­ì‹œë‚˜ ë­ë¼ê³  í•˜ëŠ”ì§€ ì˜ ëª¨ë¥´ê² ë„¤ìš”.. publihserì— ì—°ê²°í•˜ê³ .. cancellableì„ ë°˜í™˜í•œë‹¤..

ì •í™•íˆ ë­˜ í•˜ëŠ”ì§€ ì„¤ëª…ì´ ë¶€ì¡±í•œë“¯ í•˜ì—¬ í•´ë‹¹ ë©”ì†Œë“œë¥¼ ì •ì˜í•´ë‘” protocolì„ ì°¾ì•„ê°€ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

connect()ë©”ì†Œë“œëŠ” ConnectablePublisherë¼ëŠ” í”„ë¡œí† ì½œì— ì •ì˜ëœ í•¨ìˆ˜ì…ë‹ˆë‹¤.

ConnetablePublisherëŠ” ì–´ë–¤ publisherì¼ê¹Œìš”??

---

## ConnectablePublisher

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-27 á„‹á…©á„’á…® 10.47.41.png](/assets/img/blog/fleekCopy/connectablepublisher.png)

> publisherë¥¼ connectí•˜ê³  cancel í•  ìˆ˜ ìˆëŠ” explicit í•œ ë°©ë²•ì„ ì œê³µí•˜ëŠ” publicationì´ë¼ê³  í•©ë‹ˆë‹¤.
> 

ì•„ì§ì€ ì´í•´ê°€ì§€ ì•Šìœ¼ë‹ˆ, overviewë¡œ ë„˜ì–´ê°€ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- ìš”ì†Œë¥¼ ìƒì„±í•˜ê¸° ì „ì— ì¶”ê°€ êµ¬ì„±ì´ë‚˜ ì„¤ì •ì„ ìˆ˜í–‰í•´ì•¼ í•  ë•Œ ConnectablePublisherë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
- **ì´ ê²Œì‹œìëŠ” connect() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œê¹Œì§€ ì–´ë–¤ ìš”ì†Œë„ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
- makeConnectable()ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤íŒ¨ ìœ í˜•ì´ Neverì¸ ê²Œì‹œìë¡œë¶€í„° ConnectablePublisherë¥¼ ë§Œë“œì„¸ìš”.
    - í•´ë‹¹ ë¶€ë¶„ì€ ë‚´ìš©ì´ ê¸¸ì–´ì§ˆê²ƒ ê°™ì•„ ë‚˜ì¤‘ì— Combine ì •ë¦¬íŒŒíŠ¸ì— ë³„ë„ë¡œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì €í¬ê°€ ê¶ê¸ˆí–ˆë˜ê±´ connect() ì¸ë°ìš”, ì„¤ëª…ì„ ë³´ìë©´ í•´ë‹¹ ConnectablePublisherì— connect() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „ê¹Œì§€ëŠ”, ì–´ë– í•œ ë™ì‘ë„ í•˜ì§€ ì•Šê³ , connect()ê°€ ë˜ë©´ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•©ë‹ˆë‹¤.

```swift
import SwiftUI
import Combine

struct SplashView: View  {
    @State private var progress: Float = 0.0
    @State private var isComplete: Bool = false
    
    let duration: Double = 3.0
    
//1. autoconnect()ë¡œ ì„¤ì •ë˜ì–´ìˆìœ¼ë‹ˆ, í•´ë‹¹ timerê°€ êµ¬ë…ë˜ë©´ 0.01ì´ˆë§ˆë‹¤ ì´ë²¤íŠ¸ê°€ ë°©ì¶œë©ë‹ˆë‹¤.
    var timer: Publishers.Autoconnect<Timer.TimerPublisher> {
           Timer.publish(every: 0.01, on: .main, in: .common).autoconnect()
    }
    
    . . .       
  //onReceive ë©”ì†Œë“œì—ì„œ timerê°€ êµ¬ë…ì´ë˜ë©´, 0.01ì´ˆì”© perform closuerê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
        .onReceive(timer) { _ in
            if progress < 1.0 {
                progress = min(1.0, progress + 0.004)
            } else {
                withAnimation(.easeOut(duration: 1.0)) {
                    isComplete = true
                }
            }
        }
    }
}
```

---

ì£¼ì„ì„ ë‹¬ì•„ë‘” ë¶€ë¶„ì„ ë³´ë©´

- timerëŠ” autoconnect()ì†ì„±ìœ¼ë¡œ ì„ ì–¸ë˜ì–´ì ¸ ë³„ë„ì˜ connect()ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„, êµ¬ë…ê³¼ ë™ì‹œì— ì´ë²¤íŠ¸ê°€ ë°©ì¶œë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.
- onReceive ì— parametersë¡œ êµ¬ë…í•   publisherë¥¼ ë„˜ê²¨ì£¼ì–´, autoconnect() ì†ì„±ë•Œë¬¸ì—, ì´ë²¤íŠ¸ ë°©ì¶œì´ ì‹œì‘ë˜ë©° í•´ë‹¹ perform closuerë¡œ ë°©ì¶œëœ ì´ë²¤íŠ¸ê°€ ë„˜ì–´ì˜¤ê²Œ ë©ë‹ˆë‹¤.

---

ê·¼ë° ì œê°€ í•˜ê³ ì‹¶ì€ê±´ introí™”ë©´ì´ ì¢…ë£Œë˜ë©´ timerë¥¼ ëª…ì‹œì ìœ¼ë¡œ cancel ì‹œí‚¤ê³  ì‹¶ìŠµë‹ˆë‹¤.

autoconnect() ì—­ì‹œ ìë™ìœ¼ë¡œ ì—°ê²°, ì·¨ì†Œë¥¼ ê´€ë¦¬í•œë‹¤ê³  í•˜ì˜€ìœ¼ë‚˜, ì·¨ì†Œë˜ëŠ” ê²½ìš°ëŠ” publisherë¥¼ êµ¬ë…í•˜ëŠ” êµ¬ë…ìê°€ ëª¨ë‘ ì—†ì–´ì§ˆ ê²½ìš°ì…ë‹ˆë‹¤.

ì €í¬ëŠ” SplashViewê°€ ì‚¬ë¼ì§€ê¸° ì „ê¹Œì§€ëŠ” timerë¥¼ onReceiveì—ì„œ êµ¬ë…í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, timerëŠ” ê³„ì† ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ autoconnect() ê¸°ëŠ¥ì„ ì œê±°í•˜ê³  connect()ë¥¼ ì‚¬ìš©í•˜ì—¬ cancellableì„ ì „ë‹¬ë°›ê³ ,

progressê°€ ì™„ë£Œë˜ë©´ cancellable.cancel()ì„ ì‚¬ìš©í•˜ì—¬ timerë¥¼ í•´ì œí•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

---

```swift
import SwiftUI
import Combine

struct SplashView: View  {
    @State private var progress: Float = 0.0
    @State private var isComplete: Bool = false
    @State private var cancellable: Cancellable?
    
    let duration: Double = 3.0
    
    //autoconnect()ë¥¼ ì œê±°í•˜ì—¬ connect()ê°€ ë¶ˆë¦¬ê¸°ì „ê¹Œì§€ëŠ” ì´ë²¤íŠ¸ê°€ ë°©ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.
    var timer: Timer.TimerPublisher {
        Timer.publish(every: 0.01, on: .main, in: .common)
    }
    
    var body: some View {
        ZStack {
            VStack {
                Text("FLEEK")
                    .foregroundColor(.red)
                    .fontWeight(.heavy)
                    .font(.largeTitle)
                Text("ë‹¹ì‹ ì˜ ìš´ë™ì„ ì˜ë¯¸ìˆê²Œ!")
                    .foregroundColor(.white)
                
                ProgressView(value: progress)
                    .animation(.linear(duration: duration), value: progress)
                    .tint(.red)
                    .frame(width: 160)
            }
            .opacity(isComplete ? 0 : 1)
            .frame(maxWidth: .infinity, maxHeight: .infinity)
            .background(.black)
            MainTabView()
                .opacity(isComplete ? 1 : 0)
        }
        .onReceive(timer) { _ in
            print("timer is Running \(Date().timeIntervalSince1970)")
            if progress < 1.0 {
                progress = min(1.0, progress + 0.004)
            } else {
                withAnimation(.easeOut(duration: 1.0)) {
                    isComplete = true
                    print("progress complete")
                }
// progressê°€ 100% ì™„ë£Œë˜ë©´ cancellable?.cancel()ì„ í†µí•´ í•´ë‹¹ publisherë¥¼ ì œê±°í•´ì¤ë‹ˆë‹¤.
                cancellable?.cancel()
            }
        }
// í•´ë‹¹ splashViewê°€ appear ë  ë–„, timer.connect()ë¥¼ í˜¸ì¶œí•˜ì—¬ timer ì´ë²¤íŠ¸ê°€ ë°©ì¶œë˜ë„ë¡ í•©ë‹ˆë‹¤.
        .onAppear() {
//connect()ë©”ì†Œë“œëŠ” Cancellable protocolì„ returní•©ë‹ˆë‹¤.
            cancellable = timer.connect()
        }
    }
}
```

---

ì´ì   ì·¨ì†Œ ê°€ëŠ¥í•œ Cancellable propertyë„ ìƒì„±í–ˆê¸° ë•Œë¬¸ì—, ëª…ì‹œì ì¸ ì·¨ì†Œê°€ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.

ë¹Œë“œí•´ì„œ ë™ì‘ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

![Simulator Screen Recording - iPhone 14 Pro - 2023-03-27 at 23.13.33.gif](/assets/img/blog/fleekCopy/timernotworking.gif)

<aside>
ğŸ¤” progressê°€ ì›€ì§ì´ì§€ë„ ì•Šê³ , ë¡œê·¸ë¥¼ ë³´ì•„ë„ timer ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤..

</aside>

ë¶„ëª… timerë¥¼ ëª…ì‹œì ìœ¼ë¡œ connect() ì‹œì¼°ëŠ”ë°, ì™œ timer ì´ë²¤íŠ¸ê°€ ë°©ì¶œë˜ì§€ ì•Šì„ê¹Œìš”??

ì½”ë“œë¥¼ í•œì¤„í•œì¤„ ë‹¤ì‹œ ì‚´í´ë´…ë‹ˆë‹¤.. ğŸ‘€

â€¼ï¸ì´ìƒí•œì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.

```swift
 var timer: Timer.TimerPublisher {
        Timer.publish(every: 0.01, on: .main, in: .common)
 }
```

ë°”ë¡œ ì´ë¶€ë¶„ì…ë‹ˆë‹¤.

timerê°€.. **computed property**ë¡œ ì„ ì–¸ì´ ë˜ì–´ìˆì—ˆë„¤ìš”.. 

**computed property**ì´ê¸° ë–„ë¬¸ì—, timerì— ì ‘ê·¼í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ **Timer Publisher**ê°€ ìƒì„±ë˜ì–´ ë¦¬í„´ë˜ê²Œ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ onAppearì—ì„œ **timer.connect()**ë¥¼ í•´ì¤€ë“¤.. onReceiveì—ì„œ ì ‘ê·¼í•œ timerëŠ” ë˜ë‹¤ë¥¸ **Timer Publisher**ì¼í…Œë‹ˆ.. ë™ì‘ì„ í•˜ì§€ ì•Šì„ ìˆ˜ ë°–ì— ì—†ì—ˆë„¤ìš”.. ğŸ™ƒ

---

ë‹¤ì‹œ ì½”ë“œë¥¼ ìˆ˜ì •í•´ë´…ë‹ˆë‹¤.

```swift
 var timer: Timer.TimerPublisher {
        Timer.publish(every: 0.01, on: .main, in: .common)
 }
```

```swift
 var timer = Timer.publish(every: 0.01, on: .main, in: .common)
```

timerë¥¼ computed propertyê°€ ì•„ë‹Œ ë³€ìˆ˜ë¡œ ì •ì˜í•˜ì—¬ Timer.publisher instanceë¥¼ ì§ì ‘ ì €ì¥í•©ë‹ˆë‹¤.

---

```swift
import SwiftUI
import Combine

struct SplashView: View  {
    @State private var progress: Float = 0.0
    @State private var isComplete: Bool = false
    @State private var cancellable: Cancellable?
//ì¢€ë” í¸í•œ í™•ì¸ì„ ìœ„í•´ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.
    @State private var completeText: String = ""
    @State private var time: TimeInterval = 0.0
    
    let duration: Double = 3.0
    
    var timer = Timer.TimerPublisher(interval: 0.01, runLoop: .main, mode: .common)
    var body: some View {
        ZStack {
            VStack {
                Text("FLEEK")
                    .foregroundColor(.red)
                    .fontWeight(.heavy)
                    .font(.largeTitle)
                Text("ë‹¹ì‹ ì˜ ìš´ë™ì„ ì˜ë¯¸ìˆê²Œ!")
                    .foregroundColor(.white)
                
                ProgressView(value: progress)
                    .animation(.linear(duration: duration), value: progress)
                    .tint(.red)
                    .frame(width: 160)
            }
            .opacity(isComplete ? 0 : 1)
            .frame(maxWidth: .infinity, maxHeight: .infinity)
            .background(.black)
            MainTabView()
                .opacity(isComplete ? 1 : 0)
//Textë·°ë¥¼ í†µí•´ì„œ íƒ€ì´ë¨¸ ë™ì‘ê³¼ timerê°€ ë”ì´ìƒ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
            Text("timer is Running \(time)\n\(completeText)")
                .foregroundColor(.white)
                .font(.title)
                .frame(maxWidth: .infinity, maxHeight: .infinity, alignment: .top)
        }
        .onReceive(timer) { _ in
            time = Date().timeIntervalSince1970
            if progress < 1.0 {
                completeText = "isNotComplete"
                progress = min(1.0, progress + 0.004)
            } else {
                withAnimation(.easeOut(duration: 1.0)) {
                    isComplete = true
                    completeText = "completed"
                }
                cancellable?.cancel()
            }
        }
        .onAppear() {
            cancellable = timer.connect()
        }
    }
}
```

- ê°„ë‹¨í•œ ì„¤ëª…ì„ í•˜ìë©´ ì¶”ê°€ëœ 2ê°œì˜ @State propertyëŠ” timerê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ Date().timeIntervalSince1970ì„ ì €ì¥í•˜ì—¬ 0.01ì´ˆ ë§ˆë‹¤ timer ì´ë²¤íŠ¸ê°€ ë°©ì¶œë˜ì–´ timeê°’ì´ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ í”„ë¡œí¼í‹°ì…ë‹ˆë‹¤.
- completeTextëŠ” ì™„ë£Œë˜ì—ˆì„ ë•Œ completedë¼ëŠ” stringì„ ì¶œë ¥í•´ì£¼ê¸°ìœ„í•œ í”„ë¡œí¼í‹°ì…ë‹ˆë‹¤.

---

ë‹¤ì‹œí•œë²ˆ ë¹Œë“œí•˜ì—¬ ë™ì‘ì„ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

![Simulator Screen Recording - iPhone 14 Pro - 2023-03-27 at 23.31.34.gif](/assets/img/blog/fleekCopy/timerworking.gif)

ì •ìƒì ìœ¼ë¡œ timerê°€ ë™ì‘í•˜ê³ , progressê°€ ì¢…ë£Œë˜ë©´ ì •ìƒì ìœ¼ë¡œ cancelì´ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ˜„

ë‹¤ìŒ ì‹œê°„ì—ëŠ” MaintabViewì— ê°ê°ì˜ tabItemì— ë§¤ì¹­ë˜ëŠ” viewë“¤ì„ ë§Œë“¤ì–´ê°€ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.
